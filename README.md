# Тестовое задание

## Предварительная настройка окружения

В начале необходимо создать postgres базу данных mascot_test, затем с помощью скрипта create.sql(расположен в папке scripts).
В своей работе я использовал GUI утилиту DBeaver.
Далее собрать проект, запускать команду go build в папке mascot_test

## Запуск HTTP сервера

./mascot -c "config/services.json" . Сервер запускается с параметром, указывающим на конфигурационный файл

## Тестирование

Существуют два способа. Первый с помощью скриптом с использованием curl:
  getbalance.sh   - тестирование метода getBalance
  rollback.sh     - тестирование метода rollbackTransaction
  transaction.sh  - тестирование метода withdrawAndDeposit
  
  Более удобный способ тестирования - с помощью postman, необходимо будет импортировать в него файл mascot.postman_collection.json
  
## Описание решения

  ### Конфигурационный файл
  Сервисы HTTP сервера настраиваются с помощью конфигурационного файла
  
  ```
  {
   "http":{
      "listen":"127.0.0.1:8080"
   },
   "db": {
      "user": "postgres",                     - имя пользователя 
      "dbname": "mascot_test",                - имя базы данных
      "password": "postgres",                 - пароль
      "sslmode": "disable",                   - режим ssl
      "playerstbl": "players",                - таблица, хранящая информацию о балансе
      "transactiontbl": "transactions"        - таблица, хранящая информацию о транзакциях
   }
  }
  ```
  ### Приложение App
  Отвечает за запрос на создание всех остальных сервисов, их запуск и корректное завершение их работы
  
  ### Manager
  Отвечает за непосредственное создание сервисов, с помощью механизма sync.Once гарантируется
  создание толко одного экземпляра сервиса
  
  ### Сервисы
  Решение состоит из нескольких сервисов, каждый из которых имеет четко определенные обязаности:
  + http.Service   - отвечает за прием http запросов.
  + db.Service     - отвечает за работу с базой данных
  + mascot.Service - бизнес логика клиента mascot
  
  ## Дополнительные комментарии
  Не реализовано следующее требование тестового задания:
    ***иначе запрос будет повторяться примерно 1 раз в минуту до тех пор, пока не
    пройдёт 24 часа или не вернётся успешный ответ (успешным считается любой
    неошибочный ответ).***
  Здесь необходимы уточнения по логике. Для примера можно расмотреть кейс, когда rollbackTransaction закончился неудачей,
  мы его пытаемся выполнить успешно, но в тоже время может прийти новый запрос withdrawAndDeposit от пользователя, где депозит будет
  больше суммы неуспешного роллбека. Не получиться ли здесь рассинхрон по балансу.... 
